@using Magazynier.Shared
@inject IDialogService DialogService

<MudCard Class="my-5 mx4" Elevation="4">
    <MudCardHeader>
        <MudText Typo="Typo.h5" Color="_color">
            @Machine.Name @Machine.Localization <MudIcon Icon="@Icons.Material.Filled.LocationOn" Color="_color"/>
        </MudText>
    </MudCardHeader>
    <MudGrid>
        <MudItem xs="4">
            <MudContainer Fixed="true">
                <MudCardMedia Image="@Machine.ImageUrl" Height="250"/>
            </MudContainer>
        </MudItem>
        <MudItem xs="8">
            <MudCardContent>
                <MudAlert NoIcon="_noIcon" Severity="_severity" Variant="Variant.Outlined">
                    Całkowita ilość: @Machine.CurrentNumberOfProducts / @Machine.Capacity
                </MudAlert>
                <MudProgressLinear Color="_noIcon == false ? Color.Error : Color.Info" Value="Machine.CurrentNumberOfProducts" Min="0" Max="Machine.Capacity" Class="my-7"/>
                <MudList Clickable="false">
                        <MudListItem> <MudText Typo="Typo.body2">Tu może być dodatkowy opis lub informacje</MudText></MudListItem>
                        <MudDivider />
                        <MudListItem>
                            <MudButton Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Map" @onclick="OpenDialog" Color="Color.Success">Mapa</MudButton>
                            <MudButton Variant="Variant.Filled" EndIcon="@Icons.Material.Filled.Info" @onclick="OpenDialog" Color="Color.Info">Informacje</MudButton>
                        </MudListItem>
                        <MudDivider />
                </MudList>
            </MudCardContent>
        </MudItem>
    </MudGrid>
    <MudExpansionPanels>
        <MudExpansionPanel Text="Wszystkie produkty" MaxHeight="1000">
            @foreach (var product in Machine.ProductsList)
            {
                <ProductItem Product="product"/>
            }
        </MudExpansionPanel>
    </MudExpansionPanels>
</MudCard>
@code {

    [Parameter]public Machine Machine { get; set; }

    Severity _severity;
    bool _noIcon = true;
    Color _color;

    protected override void OnParametersSet()
    {
        if (Machine.IsAlmostEmpty)
        {
            _severity = Severity.Error;
            _color = Color.Error;
            _noIcon = false;
        }
        else if (Machine.IsFull)
        {
            _severity = Severity.Success;
            _color = Color.Success;
            _noIcon = true;
        }
        else
        {
            _severity = Severity.Normal;
            _noIcon = true;
        }
        
    }
    private void OpenDialog()
    {
        DialogService.Show<SimpleDialog>("Tu coś może być");
    }
    
}